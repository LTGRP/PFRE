# PFRE

Packet Filter Rule Editor, or simply PFRE is a pf rule editor for OpenBSD 5.9. PFRE is expected to be used by beginners and system administrators alike.

## Features

Using PFRE, you can develop rules from scratch or modify existing ones:

- Load, save, upload, download, and delete rule files.
- Display the rules in tabular form, parsed into their individual elements and classified to their rule types.
- Add and delete rules, and move them within the ruleset.
- Edit rules in almost all possible detail: PFRE supports most, if not all of the BNF syntax specification in pf.conf(5).
- Test individual rules and whole rulesets: PFRE validates all user input and tests rules using pfctl to provide detailed error reports on-the-fly, while editing individual rules and displaying whole rulesets.
- Install the rules as the main ruleset, and activate them by loading into pf.

A couple of notes about the requirements, design decisions, and implementation of PFRE:

- PFRE does not provide any wizards nor tries to simplify rule development by hiding details. On the contrary, PFRE enables the user by providing as much relevant detail as possible, so s/he can learn more advanced rule development.
- PFRE aims to generate text ruleset output as close to what a system administrator would produce as possible:
	+ PFRE tries to be true to the original rule file loaded: PFRE does not insert any extra lines into its output, such as any PFRE specific mark or rule generation dates (you cannot tell if the rule file is generated by PFRE or not).
	+ You can insert blank lines between rules: Blank lines are a separate rule type.
	+ Comments are a separate rule type too.
	+ All other rule types support inline comments.
- Almost all edit features provide help links to pf.conf man page, which opens in a separate tab.
- User interface is developed using gettext, such that different languages can be supported, currently only English and Turkish.
- All important messages and test results are reported in error and information boxes.
- PFRE writes detailed logs to syslog, which you can filter into separate log files.
- PFRE uses MVC design to separate business logic from presentation, e.g. the View does not know how to parse, generate, validate or test pf rules; it is as thin as possible.
- Source code is documented using Doxygen.
- PFRE has been tested using PHPUnit and Codeception.
- PFRE takes security seriously:
	+ All user input is untainted.
	+ Invalid rules are never tested using pfctl.
	+ Pfctl is executed in a separate process, which times out if pfctl takes too long.
	+ As the sole gatekeeper to the Model, PFRE controller, pfrec is the only executable enabled in doas configuration. Pfrec validates all commands and their arguments given to it.
	+ The View never reaches to the filesystem, nor runs any system executable.
	+ All system executables are called using their full path.
	+ The number of anchors in inline rules is limited.
	+ Javascript use is kept to a minimum.

## How to install

Here are possible steps to obtain a working PFRE installation:

- Install OpenBSD 5.9, perhaps in a VM.
- Install Apache 1.3.29, PHP 5.6.18, php-pcntl 5.5.37, gettext 0.19.7.
- Copy the files in PFRE src folder under /var/www/htdocs/pfre/.
- Configure a Virtual Host in httpd.conf for PFRE, preferably an SSL Virtual Host.
- Enable pfrec.php in doas by adding the following line in /etc/doas.conf:
	+ permit nopass www as root cmd /var/www/htdocs/pfre/Controller/pfrec.php
- Set the admin password for the web user interface by running the following command:
	+ /usr/local/bin/htpasswd -b -s /var/www/conf/.htpasswd admin $(/bin/echo -n soner123 | sha1 -)
- Point your web browser to the web server and log in as admin:soner123.

